version: '3.8'

services:
  # 1. MariaDB 데이터베이스 서비스
  mariadb:
    container_name: mariadb-polygon-defense
    image: mariadb:latest
    ports:
      - "3306:3306"
    environment:
      # DB 접속 정보
      MYSQL_ROOT_PASSWORD: fixjsl75767@
      MYSQL_USER: fixjsl
      MYSQL_PASSWORD: fixjsl75767@
      MYSQL_DATABASE: polygonDefense
    volumes:
      # ⬇️ 최상위 폴더 기준으로 'Database' 폴더를 상대 경로로 연결
      - ./Database:/var/lib/mysql 
    networks:
      - PolygonDefense # 기존 네트워크 이름 사용

  # 2. Node.js 서버 API 서비스
  api:
    container_name: polygon-defense-server
    build: . # 현재 디렉토리의 Dockerfile 사용
    ports:
      - "52273:52273"
    volumes:
      # ⬇️ 현재 디렉토리(.) 전체를 컨테이너 내부의 /app에 연결
      - .:/app 
    depends_on:
      - mariadb
    networks:
      - PolygonDefense

networks:
  # 외부에서 생성된 네트워크 사용
  PolygonDefense:
    external: true